# Dockerfile para desarrollo de NestJS con hot-reload
FROM node:20-alpine

# Establecer directorio de trabajo en la raíz del workspace
WORKDIR /app

# Copiar archivos de configuración de dependencias del workspace
COPY package*.json ./
COPY nx.json ./
COPY tsconfig.base.json ./
COPY eslint.config.mjs ./

# Copiar package.json de la API para instalar sus dependencias específicas
COPY apps/api/package.json ./apps/api/

# Instalar todas las dependencias (incluyendo dev dependencies)
RUN npm ci --legacy-peer-deps

# Exponer puerto 3000
EXPOSE 3000

# Comando por defecto (puede ser sobrescrito en docker-compose)
# Se ejecuta desde la raíz del workspace usando nx
CMD ["npx", "nx", "serve", "api"]

