name: CD - Simple Deploy

on:
  workflow_run:
    workflows: ["CI - All"]
    types:
      - completed
    branches:
      - main

jobs:
  deploy:
    name: Simple Deploy
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Download build artifacts
        uses: actions/download-artifact@v4
        with:
          pattern: '*-build'
          merge-multiple: true

      - name: Setup SSH
        uses: webfactory/ssh-agent@v0.9.0
        with:
          ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}

      - name: Deploy to server
        run: |
          # Example deployment script - customize based on your server setup
          # This assumes you have SSH access to your server
          
          # Copy files to server
          # scp -r apps/api/dist user@server:/path/to/api
          # scp -r apps/portal/dist user@server:/path/to/portal
          
          # Restart services
          # ssh user@server "cd /path/to/api && npm install --production && pm2 restart api"
          # ssh user@server "cd /path/to/portal && pm2 restart portal"
          
          echo "Deployment completed successfully"
        env:
          DEPLOY_HOST: ${{ secrets.DEPLOY_HOST }}
          DEPLOY_USER: ${{ secrets.DEPLOY_USER }}

